{% extends 'base/base.html' %}
{% load static %}

{% block clinicBooking_css %}
<link rel="stylesheet" type="text/css" href="{% static 'clinic/css/clinicBooking.css' %}">
{% endblock %}

{% block content %}

<div class="container-booking">
    <h1>Book Your Appointment</h1>

    <div class="progress-bar">
        <div class="progress" style="width: 0%"></div>
        <div class="step-indicator active">1</div>
        <div class="step-indicator">2</div>
        <div class="step-indicator">3</div>
    </div>

    <form id="bookingForm" method="post">
        {% csrf_token %}
        <div class="form-container">
            <!-- Step 1: Personal Information -->
            <div class="form-step active" data-step="1">
                <div class="form-row">
                    <div class="form-group">
                        <label class="required" for="first_name">First Name</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            {{ form.first_name }}
                        </div>
                        {% if form.first_name.errors %}
                        <div class="error-message">{{ form.first_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label class="required" for="last_name">Last Name</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            {{ form.last_name }}
                        </div>
                        {% if form.last_name.errors %}
                        <div class="error-message">{{ form.last_name.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required" for="email">Email</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            {{ form.email }}
                        </div>
                        {% if form.email.errors %}
                        <div class="error-message">{{ form.email.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <div class="input-with-icon">
                            <i class="fas fa-phone"></i>
                            {{ form.phone }}
                        </div>
                        {% if form.phone.errors %}
                        <div class="error-message">{{ form.phone.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="buttons">
                    <button type="button" class="btn-next" onclick="nextStep(1)">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Location & Doctor -->
            <div class="form-step" data-step="2">
                <div class="form-row">
                    <div class="form-group">
                        <label class="required" for="country">Country</label>
                        <div class="input-with-icon">
                            <i class="fas fa-globe"></i>
                            {{ form.country }}
                        </div>
                        {% if form.country.errors %}
                        <div class="error-message">{{ form.country.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label class="required" for="clinic">Select Clinic</label>
                        <div class="input-with-icon">
                            <i class="fas fa-hospital"></i>
                            {{ form.clinic }}
                        </div>
                        {% if form.clinic.errors %}
                        <div class="error-message">{{ form.clinic.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required" for="dermatologist">Select Dermatologist</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user-md"></i>
                            {{ form.dermatologist }}
                        </div>
                        {% if form.dermatologist.errors %}
                        <div class="error-message">{{ form.dermatologist.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label class="required" for="appointment_time">Appointment Date & Time</label>
                        <div class="input-with-icon">
                            <i class="fas fa-calendar-alt"></i>
                            {{ form.appointment_time }}
                        </div>
                        {% if form.appointment_time.errors %}
                        <div class="error-message">{{ form.appointment_time.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="buttons">
                    <button type="button" class="btn-prev" onclick="prevStep(2)">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button type="button" class="btn-next" onclick="nextStep(2)">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Additional Information -->
            <div class="form-step" data-step="3">
                <div class="form-group">
                    <label class="required" for="subject">Subject</label>
                    <div class="input-with-icon">
                        <i class="fas fa-heading"></i>
                        {{ form.subject }}
                    </div>
                    {% if form.subject.errors %}
                    <div class="error-message">{{ form.subject.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="message">Message</label>
                    {{ form.message }}
                    {% if form.message.errors %}
                    <div class="error-message">{{ form.message.errors }}</div>
                    {% endif %}
                </div>

                <div class="buttons">
                    <button type="button" class="btn-prev" onclick="prevStep(3)">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-check"></i> Book Appointment
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    let currentStep = 1;
    const totalSteps = 3;

    function updateProgress() {
        const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
        document.querySelector('.progress').style.width = `${progress}%`;

        document.querySelectorAll('.step-indicator').forEach((step, index) => {
            if (index + 1 < currentStep) {
                step.classList.add('complete');
                step.classList.remove('active');
            } else if (index + 1 === currentStep) {
                step.classList.add('active');
                step.classList.remove('complete');
            } else {
                step.classList.remove('active', 'complete');
            }
        });
    }

    function showStep(step) {
        document.querySelectorAll('.form-step').forEach(s => {
            s.classList.remove('active');
        });
        document.querySelector(`.form-step[data-step="${step}"]`).classList.add('active');
    }

    function nextStep(step) {
        if (step < totalSteps) {
            currentStep = step + 1;
            showStep(currentStep);
            updateProgress();
        }
    }

    function prevStep(step) {
        if (step > 1) {
            currentStep = step - 1;
            showStep(currentStep);
            updateProgress();
        }
    }

    // Form validation before submission
    document.getElementById('bookingForm').addEventListener('submit', function(e) {
        e.preventDefault();
        // Validate all required fields
        const form = this;
        const isValid = form.checkValidity();

        if (isValid) {
            form.submit();
        } else {
            // Show the step with invalid fields
            const invalidInputs = form.querySelectorAll(':invalid');
            if (invalidInputs.length > 0) {
                const step = invalidInputs[0].closest('.form-step');
                const stepNumber = parseInt(step.dataset.step);
                currentStep = stepNumber;
                showStep(stepNumber);
                updateProgress();
            }
        }
    });
</script>

{% endblock content %}